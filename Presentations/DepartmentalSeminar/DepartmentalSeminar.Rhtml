<!doctype html>
<html lang="en">
<!-- begin.rcode setup, echo=FALSE, include=FALSE
library(knitr)
library(stringr)
library(lubridate)

library(reshape2)
library(plyr)
library(dplyr)
library(magrittr)

library(ggplot2)
library(grid)
suppressMessages(library(gridExtra))
library(RColorBrewer)

library(nullabor)
library(digest)
library(Cairo)

library(lme4)
library(xtable)
suppressMessages(require(multcomp))

c0 <- knitr::knit_hooks$get('chunk')

knitr::knit_hooks$set(
  list(
    chunk=function(x,options){
      if(is.null(options$class) & is.null(options$fragIndex)){
        c0(x, options)
      } else if(is.null(options$fragIndex)) {
        classidx <- which(names(options)=="class")
        paste0(
          paste0("<span class='", options$class, "'>"),
          c0(x, options[-classidx]),
          '</span>\n'
        )
      }
      else if(length(options$fragIndex)==1) {
        classidx <- which(names(options)%in%c("class", "fragIndex"))
        str_replace(
          paste0(
            paste0("<span class='", options$class, "' data-fragment-index=", options$fragIndex,">"),
            c0(x, options[-classidx]),
            '</span>\n'
          ),
          "<div class=\"chunk\" id=\"(.*?)\">\\s*<div class=\"rimage default\">(.*)</div>\\s*</div>",
          "\\2"
        )
      } else {
        classidx <- which(names(options)%in%c("class", "fragIndex"))
        str_replace(
          paste0(
            paste0("<span class='", options$class, " fade-in' data-fragment-index=", options$fragIndex[1],">"),
            paste0(
              paste0("<span class='", options$class, " fade-out' data-fragment-index=", options$fragIndex[2],">"),
              c0(x, options[-classidx]),
              '</span>\n'
              ),
            '</span>\n'
            ),
          "<div class=\"chunk\" id=\"(.*?)\">\\s*<div class=\"rimage default\">(.*)</div>\\s*</div>",
          "\\2"
        )
        
      }
        
    }
  )
)

opts_chunk$set(cache.path='cache/', fig.width=5, fig.height=5, fig.show='hold', echo=FALSE, cache=TRUE, autodep=TRUE, message=F, warning=F, error=F)
datadir <- "../../Data/FeatureHierarchy/"
imgdir <- "../../Figure/FeatureHierarchy/"
codedir <- "../../Code/FeatureHierarchy/"

end.rcode-->

<head>
	<meta charset="utf-8">

	<title>Hierarchy of Visual Features</title>

	<meta name="description" content="Departmental Seminar (Thesis Work) slides">
	<meta name="author" content="Susan VanderPlas">

	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes, minimal-ui">

	<link rel="stylesheet" href="css/reveal.css">
	<link rel="stylesheet" href="css/theme/simple.css" id="theme">
	<link rel="stylesheet" href="css/Presentation.css">

	<!-- Code syntax highlighting -->
	<link rel="stylesheet" href="lib/css/zenburn.css">

	<!-- Printing and PDF exports -->
	<script>
		var link = document.createElement( 'link' );
		link.rel = 'stylesheet';
		link.type = 'text/css';
		link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
		document.getElementsByTagName( 'head' )[0].appendChild( link );
	</script>

	<!--[if lt IE 9]>
	<script src="lib/js/html5shiv.js"></script>
	<![endif]-->
</head>

<!-- begin.rcode body, echo=FALSE, include=FALSE

end.rcode-->
<body>
<div class="reveal">
	<!-- Any section element inside of this container is displayed as a slide -->
	<div class="slides">
			
<section> <!-- Introduction -->
  <h1 style='font-size:2.5em;'> Hierarchy of Visual Features </h1>
  <br></br>
  <h3>Susan VanderPlas</h3>
  <h4>March 30, 2015</h4>
</section>

<section>
  <section>
  	<h2> Outline </h2>
  	<ul>
  	  <li> Psychology of Perception </li>
  	    <ul>
  	      <li> Preattentive Features </li>
  	      <li> Gestalt Laws of Perception </li>
  	    </ul>
      <li> Experiment </li> 
      <li> Results </li>
      <li> Conclusions </li> 
      <li> Future Work </li>
    </ul>
  </section>
</section>

<section>
  <section class="center">
    <h2 class="title"> The Psychology of Perception </h2>
  </section>



  <section>
    <h2><span style="font-size:80%;vertical-align:middle;"> Preattentive Feature Detection </span></h3>
<!--begin.rcode preattentive-interference, echo=F, dev.args = list(bg = 'transparent'), fig.width=4, fig.height=4, out.width='30%', out.height='auto', fig.show='hold'
set.seed(51581139)

data <- data.frame(x=runif(30, 0, 1), y=runif(30, 0, 1), shape1=1)
data$shape1[15] <- 2
ggplot() +
  geom_point(data=data, aes(x=x, y=y, shape=factor(shape1)), size=5) + 
  scale_shape_manual(guide="none", values=c(1,0))+
  xlab(NULL) + ylab(NULL) + 
  theme_minimal() + 
  theme(axis.text=element_blank(), axis.ticks=element_blank(), axis.title=element_blank(),
        line=element_blank(), rect=element_blank(), text=element_blank(), title=element_blank(),
        panel.background = element_rect(fill = "transparent", colour = NA),
        plot.background = element_rect(fill = "transparent", colour = NA),
        plot.margin=unit(c(0,0,0,0), "cm"))

set.seed(51581139)
data <- data.frame(x=runif(30, 0, 1), y=runif(30, 0, 1), shape1=1)
data$shape1[24] <- 2
ggplot() +
  geom_point(data=data, aes(x=x, y=y, color=factor(shape1)), shape=16, size=5) + 
  scale_color_manual(guide="none", values=c("#FFA89D", "#FFE19D")) + 
  geom_point(data=data, aes(x=x, y=y), shape=1, size=5, color="black") + 
  xlab(NULL) + ylab(NULL) + 
  theme_minimal() + 
  theme(axis.text=element_blank(), axis.ticks=element_blank(), axis.title=element_blank(),
        line=element_blank(), rect=element_blank(), text=element_blank(), title=element_blank(),
        panel.background = element_rect(fill = "transparent", colour = NA),
        plot.background = element_rect(fill = "transparent", colour = NA),
        plot.margin=unit(c(0,0,0,0), "cm"))

set.seed(51581139)
data <- data.frame(x=runif(30, 0, 1), y=runif(30, 0, 1), shape1=sample(1:2, size=30, replace=T))
data$color1 <- data$shape1
data[8, c("shape1", "color1")] <- c(1,2)
ggplot() +
  geom_point(data=data, aes(x=x, y=y, shape=c(16, 15)[shape1], color=factor(color1)), size=5) + 
  geom_point(data=data, aes(x=x, y=y, shape=c(1, 0)[shape1]), size=5, color="black") + 
  scale_color_manual(guide="none", values=c("#FFA89D", "#FFE19D")) + 
  scale_shape_identity()+
  xlab(NULL) + ylab(NULL) + 
  theme_minimal() + 
  theme(axis.text=element_blank(), axis.ticks=element_blank(), axis.title=element_blank(),
        line=element_blank(), rect=element_blank(), text=element_blank(), title=element_blank(),
        panel.background = element_rect(fill = "transparent", colour = NA),
        plot.background = element_rect(fill = "transparent", colour = NA),
        plot.margin=unit(c(0,0,0,0), "cm"))
end.rcode-->
    <p> Combinations of preattentive features interfere with each other and are not preattentive.  </p>
  </section>


  <section>
    <h2> Perception of Statistical Plots </h2>
      <ul>
        <li style="margin-top:20px;margin-bottom:20px"> We don't perceive plots preattentively, but some research has studied preattentive plot perception (Healy & Enns, 1999, 2012)
        </li>
          
        <li style="margin-top:20px;margin-bottom:20px"> Rough hierarchy of graphical features (accuracy): </li>
        <table>
          <tr>
            <td style="vertical-align:middle;text-align:center;">color **</td>
            <td style="vertical-align:middle;text-align:center;">$$>$$</td>
            <td style="vertical-align:middle;text-align:center;">shape<br>intensity<br>letters (HQX)</td>
            <td style="vertical-align:middle;text-align:center;">$$>$$</td>
            <td style="vertical-align:middle;text-align:center;">letters (HEF)</td>
          </tr>
        </table>
        <p  style="font-size:75%;"> Cleveland & McGill (1985), Lewandowsky & Spence (1989)
      </ul>
  </section>
  
  <section>
    <h2> Gestalt Laws </h2>
    <p> Subconsciously order and group visual input </p>
<!--begin.rcode gestalt, dev.args = list(bg = 'transparent'), echo=FALSE, fig.width=6, fig.height=4, out.width='60%'
logit <- function(x, a, b){
  exp((x-a)/b)/(1+exp((x-a)/b))
}
  data <- rbind(
    data.frame(
      x = c(1, 2, 4, 5, 7, 8), 
      y = 4.5,
      group = 1,
      label = "Proximity"
    ),
    data.frame(
      x = c(1:8), 
      y = 3.75,
      group = rep(1:2, each=2, times=2),
      label = "Similarity"
    ),
    data.frame(
      x = c(seq(1, 4, length.out=50), seq(1, 4, length.out=50), 
            seq(4.825, 6.375, length.out=25), rev(seq(4.825, 6.375, length.out=25)), 
            rev(seq(6.625, 8.125, length.out=25)), seq(6.625, 8.125, length.out=25)),
      y = 2.55 + .9*
        c(logit(seq(1, 4, length.out=50), 2.5, .75), logit(seq(1, 4, length.out=50), 2.5, -.75),
          logit(seq(4.75, 6.25, length.out=25), 6.25, .75), logit(rev(seq(4.75, 6.25, length.out=25)), 6.25, -.75),
          logit(rev(seq(6.5, 8, length.out=25)), 6.5, .75), logit(seq(6.5, 8, length.out=25), 6.5, -.75)),
      group = rep(1:4, each=50),
      label = "Continuity"
    ),
    data.frame(
      x = c(1.5, 2.5, 4, 5, 6.5, 7.5), 
      y = 2,
      group = c(1, 2, 2, 1, 1, 2),
      label = "Common Region"
    )
  ) 
  
  ggplot() + 
    geom_point(data=subset(data, label!="Continuity"), aes(x=x, y=y, group=group, color = factor(group)), size=6) + 
    geom_point(data=subset(data, label!="Continuity"), aes(x=x, y=y, group=group), shape=1, color="black", size=6) + 
    geom_path(data=subset(data, label=="Continuity"), aes(x=x, y=y, group=group), inherit.aes=F) + 
    geom_rect(aes(xmin=c(1, 3.5, 6), xmax=c(3, 5.5, 8), ymin=rep(1.75, 3), ymax=rep(2.25, 3)), inherit.aes=F, fill=NA, color="black") + 
    scale_color_manual(guide="none", values=c("#FDFEFF", "#4F91AD")) + 
    geom_text(aes(x=rep(-1, 4), y=c(2, 3, 3.75, 4.5), label=c("Common\nRegion", "Continuity", "Similarity", "Proximity")), hjust=0, vjust=.5) + 
    xlab(NULL) + ylab(NULL) + 
    ylim(c(1.5, 4.75)) + 
    theme_minimal()  + 
    theme(axis.text=element_blank(), axis.ticks=element_blank(), axis.title=element_blank(),
    line=element_blank(), rect=element_blank(), text=element_blank(), title=element_blank(),
    panel.background = element_rect(fill = "transparent", colour = NA),
    plot.background = element_rect(fill = "transparent", colour = NA),
    plot.margin=unit(c(0,0,0,0), "cm"))
end.rcode-->
  </section>
</section>


<!--begin.rcode experiment-setup, echo=FALSE, include=FALSE, cache=TRUE
source(paste0(codedir, "MixtureLineups.R"))
source(paste0(codedir, "theme_lineup.R"))
lineups <- read.csv(paste0(datadir, "data-picture-details-gini.csv"), stringsAsFactors=FALSE)
lineups$pic_id_old <- lineups$pic_id
lineups$pic_id <- 1:nrow(lineups)

users <- read.csv(paste0(datadir, "turk16_users_anon.csv"), stringsAsFactors=F, header=F)
names(users) <- c("nick_name", "age", "gender", "education", "ip_address")
users$age <- factor(users$age, levels=0:10, labels=c("NA", "<18", "18-25", "26-30", "31-35", "36-40", "41-45", "45-50", "51-55", "56-60", "61+"))
users$gender <- factor(users$gender, levels=0:2, labels=c("NA", "Male", "Female"))
users$education <- factor(users$education, levels=0:5, labels=c("NA", "High School or less", "Some college", "Bachelor's degree", "Some graduate school", "Graduate degree"))

userdata <- read.csv(paste0(datadir, "turk16_results_anon.csv"), stringsAsFactors=FALSE)
userdata$response.id <- 1:nrow(userdata)
# table(userdata$ip_address, userdata$nick_name)

tmp <- merge(userdata[!is.na(userdata$pic_id),], lineups[,c("pic_id", "sample_size", "test_param", "param_value", "p_value", "obs_plot_location")], all.x=T, all.y=F)
tmp$k <- as.numeric(substr(tmp$param_value, 3, 3))
tmp$sd.line <- as.numeric(substr(tmp$param_value, 12, 15))
tmp$sd.cluster <- as.numeric(substr(tmp$param_value, 25, 28))

correct.ans <- function(x,y){
  x1 <- as.numeric(str_trim(unlist(str_split(x, ","))))
  answers <- str_trim(unlist(str_split(y, ",")))
  lineplot <- as.numeric(answers[1])
  groupplot <- as.numeric(answers[2])
  giniplot <- ifelse(groupplot==as.numeric(answers[3]) | lineplot==as.numeric(answers[3]), NA, as.numeric(answers[3]))
  c(n.answers=length(x1), trend.correct=lineplot%in%x1, cluster.correct=groupplot%in%x1, both.correct = lineplot%in%x1 & groupplot%in%x1, neither.correct=!(lineplot%in%x1 | groupplot%in%x1), none.correct=!(lineplot%in%x1 | groupplot%in%x1 | giniplot%in%x1), gini.correct=giniplot%in%x1)
}

useranswers <- ddply(tmp, .(response.id), function(df) correct.ans(df$response_no, df$obs_plot_location))
useranswers <- merge(useranswers, tmp)
useranswers$plottype <- gsub("turk16-", "", useranswers$test_param)
useranswers$plottype <- factor(useranswers$plottype, levels=c("plain", "trend", "color", "shape", "colorShape", "colorEllipse", "colorTrend",  "trendError", "colorShapeEllipse", "colorEllipseTrendError"))
useranswers$sd.cluster <- factor(useranswers$sd.cluster)
useranswers$sd.line <- factor(useranswers$sd.line)
useranswers$k <- factor(useranswers$k)
useranswers$start_time <- ymd_hms(useranswers$start_time)
useranswers$end_time <- ymd_hms(useranswers$end_time)
useranswers <- ddply(useranswers, .(param_value, test_param), transform, param_idx=as.numeric(factor(pic_id)))
useranswers <- ddply(useranswers, .(ip_address, nick_name), transform, ntrials = length(unique(pic_id)), trial.no = rank(start_time), trial.num=order(start_time))

# Remove data from <18 participants
useranswers <- filter(useranswers, !nick_name%in%users$nick_name[users$age=="<18"])
users <- filter(users, age!="<18")

modeldata <- useranswers[,c(1, 2, 9:30, 3:8)]

# Remove data from participants who did not complete 10 trials
incomplete.participants <- unique(modeldata$nick_name[modeldata$ntrials<10])
incomplete.participant.data <- sum(modeldata$ntrials<10)
message(paste0(sum(modeldata$ntrials<10), " trials removed because participant completed <10 trials total."))
# Remove data from participants who completed > 10 trials
modeldata <- filter(modeldata, ntrials>=10)
extra.participant.data <- sum(modeldata$trial.num>10)
message(paste0(sum(modeldata$trial.num>10), " trials removed because participant >10 trials."))
modeldata <- filter(modeldata, trial.num<=10)
# Remove users from database who didn't complete any trials
message(paste0(sum(!users$nick_name%in%modeldata$nick_name), " users removed from user database - no trials found."))
users <- users %>% filter(nick_name%in%modeldata$nick_name)
modeldata <- modeldata[,-30]

modeldata$outcome <- paste(c("", "trend")[1+as.numeric(modeldata$trend.correct==1)], 
                           c("", "cluster")[1+as.numeric(modeldata$cluster.correct==1)], 
                           c("", "neither")[1+as.numeric(modeldata$neither.correct==1)], 
                           c("", "gini")[1+as.numeric(modeldata$gini.correct==1)], 
                           sep="")
modeldata$outcome[modeldata$both.correct==1] <- "both"
modeldata$first.trial <- modeldata$trial.no == 1
modeldata$simpleoutcome <- gsub("gini", "", modeldata$outcome)
modeldata$simpleoutcome <- factor(modeldata$simpleoutcome, levels=c("neither", "cluster", "trend","both"))

modeldata <- merge(modeldata, lineups[,c("pic_id", "data_name", "param_value")], all.x=T, all.y=T)
modeldata$dataset <- factor(str_extract(modeldata$data_name, "set-\\d{1,3}") %>% str_replace("set-", "") %>% as.numeric)
modeldata$individualID <- factor(sprintf("%s-%s", modeldata$ip_address, modeldata$nick_name))
modeldata$k <- factor(modeldata$k, levels=c(3, 5))
modeldata$parameter.value <- factor(gsub("set-\\d{1,3}-", "", modeldata$data_name))
modeldata$start_time <- ymd_hms(modeldata$start_time)
modeldata$end_time <- ymd_hms(modeldata$end_time)
modeldata$trial.time <- with(modeldata, end_time-start_time)
modeldata <- ddply(modeldata, .(k), transform, trend.diff=c("easy", "medium", "hard")[as.numeric(droplevels(sd.line))], cluster.diff=c("easy", "medium", "hard")[as.numeric(droplevels(sd.cluster))])
modeldata$trend.diff <- factor(modeldata$trend.diff, levels=c("easy", "medium", "hard"))
modeldata$cluster.diff <- factor(modeldata$cluster.diff, levels=c("easy", "medium", "hard"))
modeldata$cluster.diff2 <- factor(modeldata$cluster.diff, levels=c("easy", "medium", "hard"), labels=c("Cluster: Easy", "Cluster: Medium", "Cluster: Hard"))
modeldata$trend.diff2 <- factor(modeldata$trend.diff, levels=c("easy", "medium", "hard"), labels=c("Trend: Easy", "Trend: Medium", "Trend: Hard"))

parameter.design <- unique(modeldata[,c("dataset", "k", "trend.diff", "cluster.diff")])

plot.eval.tab <- apply(with(modeldata, table(dataset, plottype)), 1:2, sum)

# long dataset for table-esque plots
modeldata.long <- melt(modeldata, id.vars=which(!grepl("(correct)|(outcome)", names(modeldata))), value.vars=c("trend.correct", "cluster.correct", "neither.correct"), value.name="correct", variable.name="answer.type")
modeldata.long$answer.type <- gsub(".correct", "", modeldata.long$answer.type)
modeldata.long <- filter(modeldata.long, answer.type%in%c("cluster", "trend", "neither"))
modeldata.long$correct <- as.numeric(modeldata.long$correct)
modeldata.long$answer.type <- factor(modeldata.long$answer.type, levels=c("cluster", "trend", "neither"))
modeldata.long$plottype <- 
  modeldata.long$plottype %>%
  str_replace("color", "Color + ") %>% 
  str_replace("[sS]hape", "Shape + ") %>%
  str_replace("[tT]rend", "Trend + ") %>%
  str_replace("Ellipse", "Ellipse + ") %>%
  str_replace("Error", "Error + ") %>%
  str_replace("plain", "Plain") %>%
  str_replace("( \\+ )$", "") %>% 
  factor(levels=c("Plain", "Color", "Shape", "Trend", "Trend + Error", 
                  "Color + Shape", "Color + Ellipse", "Color + Trend", 
                  "Color + Shape + Ellipse", "Color + Ellipse + Trend + Error"),
         labels=c("Plain", "Color", "Shape", "Trend", "Trend + Error", 
                  "Color + Shape", "Color + Ellipse", "Color + Trend", 
                  "Color + Shape + Ellipse", "Color + Ellipse + Trend + Error"))


totaltime <- ddply(modeldata, .(individualID), summarize, total.experiment.time = max(end_time)-min(start_time))

colors <-  c("#1f77b4", "#ff7f0e", "#2ca02c", "#d62728", "#9467bd", 
             "#8c564b", "#e377c2", "#7f7f7f", "#bcbd22", "#17becf")
shapes <- c(1,0,3,4,8,5,2,6,-0x25C1, -0x25B7)

colortm <- read.csv(paste0(datadir, "color-perceptual-kernel.csv"))
# colortm[3,4] <- 0
# colortm[4,3] <- 0
colortm[8,] <- 0
colortm[,8] <- 0

shapetm <- read.csv(paste0(datadir, "shape-perceptual-kernel.csv"))
# shapetm[9:10,] <- 0
# shapetm[, 9:10] <- 0
shapetm[9,] <- 0
shapetm[,9] <- 0
shapetm[10,] <- 0
shapetm[,10] <- 0

color3pal <- best.combo(3, colors, colortm)
color5pal <- best.combo(5, colors, colortm)
shape3pal <- best.combo(3, shapes, shapetm)
shape5pal <- best.combo(5, shapes, shapetm)
end.rcode-->

<section>
  <section class="center">
    <div> <h2>Experiment:</h2> <h3> How do plot aesthetics affect perception of statistical plots with competing signals? </h3></div>
  </section>
    
  <section>
    <h2> Lineups </h2>
<!--begin.rcode testlineup, echo=F, fig.width=6, fig.height=6, out.width='50%', out.height='auto', cache=T
data <- gen.test.data(list(N=45, K=3, sd.cluster=.2, sd.trend=.25, type="trend"))
gen.plot(dd=data, aes=NULL, stats=NULL)
end.rcode-->
  </section>
  
  <section>
    <h2> Data-Generating Models </h2>
    <p> Provides participants with ambiguous distractor plots generated from a mixture of the two target models </p>
<!--begin.rcode datamodels, dev.args = list(bg = 'transparent'), echo=F, fig.width=4, fig.height=4, out.width='300px', out.height='300px', fig.show='hold'

  set.seed(50980)
  data <- mixture.sim(lambda=0, K=3, N=45, sd.trend=.25, sd.cluster=.20)
  qplot(data=data, x=x, y=y, geom="point", size=I(3), shape=I(1)) + 
    xlim(c(-2, 2)) + ylim(c(-2, 2)) + 
    xlab(NULL) + ylab(NULL) + 
    geom_text(aes(x=-1.9, y=1.9, label="Trend Model"), hjust=0, vjust=1, size=6) +
    theme_minimal()  + 
    theme(axis.text=element_blank(), axis.title=element_blank(),
          text=element_blank(), title=element_blank(),
          panel.border = element_rect(fill=NA, color="black"),
          panel.background = element_rect(fill = "grey90", colour = NA),
          plot.background = element_rect(fill = "transparent", colour = NA),
          plot.margin=unit(c(0,0,0,0), "cm"))
  set.seed(50980)
  data <- mixture.sim(lambda=.5, K=3, N=45, sd.trend=.25, sd.cluster=.20)
  qplot(data=data, x=x, y=y, geom="point", size=I(3), shape=I(1)) + 
    xlim(c(-2, 2)) + ylim(c(-2, 2)) + 
    xlab(NULL) + ylab(NULL) + 
    geom_text(aes(x=-1.9, y=1.9, label="50% Mixture"), hjust=0, vjust=1, size=6) +
    theme_minimal()  + 
    theme(axis.text=element_blank(), axis.title=element_blank(),
          text=element_blank(), title=element_blank(),
          panel.border = element_rect(fill=NA, color="black"),
          panel.background = element_rect(fill = "grey90", colour = NA),
          plot.background = element_rect(fill = "transparent", colour = NA),
          plot.margin=unit(c(0,0,0,0), "cm"))
  set.seed(50980)
  data <- mixture.sim(lambda=1, K=3, N=45, sd.trend=.25, sd.cluster=.20)
  qplot(data=data, x=x, y=y, geom="point", size=I(3), shape=I(1)) + 
    xlim(c(-2, 2)) + ylim(c(-2, 2)) + 
    xlab(NULL) + ylab(NULL) + 
    geom_text(aes(x=-1.9, y=1.9, label="Cluster Model"), hjust=0, vjust=1, size=6) +
    theme_minimal()  + 
    theme(axis.text=element_blank(), axis.title=element_blank(),
          text=element_blank(), title=element_blank(),
          panel.border = element_rect(fill=NA, color="black"),
          panel.background = element_rect(fill = "grey90", colour = NA),
          plot.background = element_rect(fill = "transparent", colour = NA),
          plot.margin=unit(c(0,0,0,0), "cm"))
  
end.rcode-->
    <div style="font-size:75%;">
    <table class="noborder nowidth">
      <tr>
        <td colspan=3 style="text-align:center;border-bottom: 1px solid;"> Parameters </td>
      </tr><tr>
        <td width="300px" style="text-align:center;vertical-align:middle;" rowspan=2> $\sigma_T$: Variability in $y$</td>
        <td width="300px" style="text-align:center;vertical-align:middle;" rowspan=2> $\lambda$: Mixing parameter </td>
        <td width="300px" style="text-align:center;vertical-align:middle;"> $K$: # clusters </td>
      </tr><tr>
        <td width="300px" style="text-align:center;vertical-align:middle;">$\sigma_C$: Variability around cluster centers</td>
      </tr><tr>
        <td colspan=3 style="text-align:center;border-top: 1px solid;">
    </table>
    </div>
    
  </section>
    
  <section>
    <h2> Lineups </h2>
    <img src="image/0636bb5b6e605eba0b61211186e18aac.png" width='50%' height='auto'/>
  </section>
  
  <section>
    <h2> Plot Aesthetic Combinations </h2>
    <table style="border-collapse: collapse;">
      <tr>
        <td colspan=2></td><td class="bb" colspan=3 style="text-align:center;">Line Emphasis</td>
      </tr><tr style="text-align:center;">
        <td></td>
        <td class="bb br">Strength</td>
        <td class="bb" style="text-align:center;background-color:#d3ebf1;">0</td>
        <td class="bb" style="text-align:center;background-color:#9ad0de;">1</td>
        <td class="bb br" style="text-align:center;background-color:#87c7d7;">2</td>
      </tr><tr>
        <td rowspan=4 style="vertical-align:middle;">Cluster<br>Emphasis</td>
        <td class="br bl" style="text-align:center;background-color:#d3ebf1;">0</td>
        <td style="text-align:center;background-color:#d3ebf1;">Plain</td>
        <td style="text-align:center;background-color:#9ad0de;">Line</td>
        <td class="br" style="text-align:center;background-color:#87c7d7;">Line + Pred. Interval</td>
      </tr><tr>
        <td class="br bl" style="text-align:center;background-color:#9ad0de;">1</td>
        <td style="text-align:center;background-color:#9ad0de;">Color<br>Shape</td>
        <td style="text-align:center;background-color:#d3ebf1">Color + Line</td>
        <td class="br"></td>
      </tr><tr>
        <td class="br bl" style="text-align:center;background-color:#87c7d7;">2</td>
        <td style="text-align:center;background-color:#87c7d7;">Color + Shape<br>Color + Ellipse</td>
        <td></td>
        <td class="br" style="text-align:center;background-color:#d3ebf1;">Color + Ellipse + <br>Line + Pred. Interval</td>
      </tr><tr>
        <td class="br bb bl" style="text-align:center;background-color:#73bed1;">3</td>
        <td class="bb" style="text-align:center;background-color:#73bed1;">Color + Shape + Ellipse</td>
        <td class="bb"></td>
        <td class="bb br"></td>
      </tr>
    </table>
  </section>

  <section>
    <h2> Experiment Structure </h2>
    <table class="noborder">
      <tr>
        <td style="padding-right:50px;vertical-align:top;">
          <div style="vertical-align:top;display:inline-block;">
            <h5> <b>Model Parameters</b> </h5>
            <div style="font-size:70%;">
              <ul>
                <li> Trend Strength <span style="text-align:right">$\sigma_T =$ easy, med., hard </span></li>
                <li> Cluster Strength <span style="text-align:right">$\sigma_C =$ easy, med., hard </span></li>
                <li> Number of Clusters <span style="text-align:right">$K =$ 3, 5 </span></li>
              <ul>
            </div>
          </div>
        </td>
        <td style="padding-left:50px;vertical-align:top;">
          <h5> <b>Plot Level</b> </h5>
          <div style="font-size:75%;">
            <ul>
              <li> 18 parameter combinations </li>
              <li> 3 datasets/parameter combination </li>
              <li> 10 plot types for each dataset <br>
                   = 540 total plots </li>
            </ul>
          </div>
        </td>
      </tr>
      <tr>
        <td style="padding-right:50px;vertical-align:top;">
          <h4 style="text-align:center"> <b>Plot Aesthetics</b> </h4>
          <div style="font-size:70%;display:inline-block;">
            <ul>
              <li> Plain </li>
              <li> Trend </li>
              <li> Trend + Error </li>
              <li> Color + Trend </li>
              <li> Color + Ellipse<br>+ Trend + Error </li>
            </ul>
          </div>
          <div style="font-size:70%;display:inline-block;">
            <ul>
              <li> Color </li>
              <li> Shape </li>
              <li> Color + Shape </li>
              <li> Color + Ellipse </li>
              <li> Color + Shape<br>+ Ellipse </li>
            </ul>
          </div>
        </td>
        <td style="padding-left:50px;vertical-align:bottom;">
          <h5> <b> Evaluation Level </b> </h5>
          <div style="font-size:75%;">
            <ul>
              <li> Participants evaluate 10 plots: </li>
              <ul>
                <li> 1 of each aesthetic </li>
                <li> 1 of each combination of $\sigma_T$ and $\sigma_C$<br>randomized over $K$ </li>
              </ul>
            </ul>
          </div>
        </td>
      </tr>
    </table>
  </section>
  
  <section>
    <h2>Data Collection</h2>
      <ul style="margin-bottom:30px">
        <li> Participants recruited through Amazon Mechanical Turk </li>
        <li> Experiment ran for <!--rinline round(as.numeric(difftime(max(modeldata$end_time), min(modeldata$start_time), units="hours")), 2) --> hours </li>
        <li> <!--rinline length(unique(userdata$nick_name))-->  individuals completed <!--rinline nrow(userdata)--> evaluations </li> <br>
        <li> Data removed: </li>
        <ul>
          <li> Participants who did not complete 10 trials: <br>
               <!--rinline length(incomplete.participants)--> participants, 
               <!--rinline incomplete.participant.data--> trials </li>
          <li> Any trials in excess of 10 for each participant (<!--rinline extra.participant.data--> trials)</li>
        </ul>
      </ul>
      <p> Final dataset: <!--rinline nrow(modeldata)--> trials completed by <!--rinline length(unique(modeldata$individualID))--> participants. </p>
  </section>
  
  <section>
    <h2>Data Collection</h2>
      <h3> Participants provided: </h3>
      <ul style="margin:.2em">
        <li> Demographic information: age range, gender, education level </li>
        <li> 10 plot evaluations
        <ul>
          <li> Target plot identification (one or more sub-plots) </li>
          <li> Level of confidence in their answer (1 = least, 5=most)  </li> 
          <li> Reasoning <br> (i.e. "Strongest linear relationship", "Clustered points", "Odd shape") </li>
        </ul>
      </ul>
  </section>
        
  <section>
    <h2> Target Identification </h2>
<!--begin.rcode target-aggregate, echo=F, include=T, fig.width=8, fig.height=4, out.width='80%', out.height='auto'
user.data <- modeldata %>% group_by(individualID) %>% 
summarize(answers=length(individualID),
          cluster=sum(cluster.correct),
          trend=sum(trend.correct))
clusters <- as.data.frame(table(user.data$cluster))
trends <- as.data.frame(table(user.data$trend))
names(clusters) <- c("x", "Cluster")
clusters$Trend <- trends$Freq 
clm <- melt(clusters, measure.var=2:3)

ggplot() + geom_point(aes(x, value, colour=variable, shape=variable), size=3, data=clm) + theme_bw() + scale_colour_brewer("Target", palette="Set1") + scale_shape_discrete("Target") + theme(legend.position=c(.85, .9), legend.direction="horizontal") + ylab("Number of participants") + xlab("Number of target identifications (out of ten)") + geom_line(aes(x, value, colour=variable, group=variable), data=clm) + ggtitle("Target Identification by Participants")
end.rcode-->
  </section>
  
  <section>
    <h2> Modeling Target Plot Selection </h2>
    <br></br>
    $$
    \begin{align}
    \text{logit }P(\text{success}) & =  \textbf{X}\beta + \textbf{J}\gamma + \textbf{K}\eta + \epsilon, \\
    \text{where } \beta_i & \hphantom{\sim} \text{describe the effect of specific plot aesthetics}\\
    \hphantom{where } \gamma_j & \overset{iid}{\sim} N\left(0, \sigma^2_{\text{dataset}}\right)\\
    \hphantom{where } \eta_k & \overset{iid}{\sim} N\left(0, \sigma^2_{\text{participant}}\right)\\
    \text{and } \epsilon_{ijk} & \overset{iid}{\sim}  N\left(0, \sigma^2_e\right)
    \end{align}
    $$
    <p> Variability due to model parameters is contained within the random effects for dataset </p>
  </section>
  
  <section>
    <h2> Line Target Identification </h2>
<!--begin.rcode line-target, echo=F, include=T, fig.width=6, fig.height=3, out.width='70%', out.height='auto'
line.model <- glmer(trend.correct ~ plottype + (1|individualID) + (1|dataset), 
                    data = modeldata, 
                    family = binomial(link="logit"), 
                    control=glmerControl(optimizer="bobyqa"))
line.fixef <- data.frame(summary(line.model)$coefficients, confint(line.model, method="Wald"))
names(line.fixef) <- c("Estimate", "StdError", "Z", "p value", "LB", "UB")
line.fixef$OR <- exp(line.fixef[,1])
line.fixef$label <- gsub("(Intercept)", "", gsub("plottype", "", rownames(line.fixef)), fixed=T)

type_compare <- glht(line.model, mcp(plottype="Tukey"))
line.fixef$letters <- cld(type_compare)$mcletters$Letters

line.fixef.aes <- line.fixef[grepl("(color)|([Ss]hape)|([Tt]rend)|(Ellipse)|(Error)", rownames(line.fixef)),]
line.fixef.aes <- line.fixef.aes[order(line.fixef.aes$OR, decreasing = T),]
line.fixef.aes$label <- 
  line.fixef.aes$label %>% 
  str_replace("color", "Color + ") %>% 
  str_replace("[sS]hape", "Shape + ") %>%
  str_replace("[tT]rend", "Trend + ") %>%
  str_replace("Ellipse", "Ellipse + ") %>%
  str_replace("Error", "Error + ") %>%
  str_replace("( \\+ )$", "")
line.fixef.aes$label <- factor(line.fixef.aes$label, levels=line.fixef.aes$label[order(line.fixef.aes$OR, decreasing = T)], ordered=T)
line.fixef.aes$LB <- exp(line.fixef.aes$LB)
line.fixef.aes$UB <- exp(line.fixef.aes$UB)

qplot(data=line.fixef.aes, x=label, y=OR, ymin=LB, ymax=UB, geom="pointrange") + 
  geom_text(aes(x=label, y=0, label=letters)) + 
  coord_flip() + 
  ylab("Odds + 95% Wald Interval") + 
  xlab("") + 
  geom_hline(yintercept=1, colour="gray70") +
  ggtitle("Odds of Selecting Line Target Plot") + 
  theme_bw()
end.rcode-->
    <p> Trend + Error plots increase the odds of line target selection; <br>Color + Shape + Ellipse aesthetics decrease the odds of line target selection. </p> 
  </section>
  
  <section>
    <h2> Gestalt Heuristics and Aesthetics </h2>
    <h3> Line Target Plots </h3>
    <table class="noborder">
      <tr>
        <td width='30%' style="vertical-align:middle;text-align:center;">
<!--begin.rcode gestaltplots1, dev.args = list(bg = 'transparent'), class="fragment", fragIndex=2, echo=F, fig.width=4, fig.height=4, out.width='275px', out.height='275px'

  set.seed(50980)
  data <- mixture.sim(lambda=0, K=3, N=45, sd.trend=.25, sd.cluster=.20)
  qplot(data=data, x=x, y=y, geom="point", size=I(3), shape=I(1)) + 
    xlim(c(-2, 2)) + ylim(c(-2, 2)) + 
    xlab(NULL) + ylab(NULL) + 
    geom_text(aes(x=-1.9, y=1.9, label="Continuity"), hjust=0, vjust=1, size=6, inherit.aes=F) +
    theme_minimal()  + 
    theme(axis.text=element_blank(), axis.title=element_blank(),
          text=element_blank(), title=element_blank(),
          panel.border = element_rect(fill=NA, color="black"),
          panel.background = element_rect(fill = "grey90", colour = NA),
          plot.background = element_rect(fill = "transparent", colour = NA),
          plot.margin=unit(c(0,0,0,0), "cm"))
  
end.rcode-->
        </td>
        <td width='30%' style="vertical-align:middle;text-align:center;">
<!--begin.rcode gestaltplots2, dev.args = list(bg = 'transparent'), class="fragment", fragIndex=3, echo=F, include=T, fig.width=4, fig.height=4, out.width='275px', out.height='275px'

  set.seed(50980)
  data <- mixture.sim(lambda=0, K=3, N=45, sd.trend=.25, sd.cluster=.20)
  model <- lm(y~x, data=data)
  range <- diff(range(data$x))
  newdata <- data.frame(x=seq(min(data$x)-.1*range, max(data$x)+.1*range, length.out=400))
  ci <- data.frame(.sample=1, x=newdata$x, 
                   predict.lm(model, newdata=newdata, interval="prediction", level=0.9))
  qplot(data=data, x=x, y=y, geom="point", size=I(3), shape=I(1)) + 
    geom_line(aes(x=x, y=fit), color="black", data=ci) + 
    xlim(c(-2, 2)) + ylim(c(-2, 2)) + 
    xlab(NULL) + ylab(NULL) + 
    geom_text(aes(x=-1.9, y=1.9, label="Continuity (points) + \nContinuity (line)"), hjust=0, vjust=1, size=6) +
    theme_minimal()  + 
    theme(axis.text=element_blank(), axis.title=element_blank(),
          text=element_blank(), title=element_blank(),
          panel.border = element_rect(fill=NA, color="black"),
          panel.background = element_rect(fill = "grey90", colour = NA),
          plot.background = element_rect(fill = "transparent", colour = NA),
          plot.margin=unit(c(0,0,0,0), "cm"))
  
end.rcode-->
        </td>
        <td width='30%' style="vertical-align:middle;text-align:center;">
<!--begin.rcode gestaltplots3, dev.args = list(bg = 'transparent'), class="fragment", fragIndex=4, echo=F, include=T, fig.width=4, fig.height=4, out.width='275px', out.height='275px'

  set.seed(50980)
  data <- mixture.sim(lambda=0, K=3, N=45, sd.trend=.25, sd.cluster=.20)
  model <- lm(y~x, data=data)
  range <- diff(range(data$x))
  newdata <- data.frame(x=seq(min(data$x)-.1*range, max(data$x)+.1*range, length.out=400))
  ci <- data.frame(.sample=1, x=newdata$x, 
                   predict.lm(model, newdata=newdata, interval="prediction", level=0.9))
  qplot(data=data, x=x, y=y, geom="point", size=I(3), shape=I(1)) + 
    geom_line(aes(x=x, y=fit), color="black", data=ci) + 
    geom_line(aes(x=x, y=lwr), lty=2, color="black", data=ci) + 
    geom_line(aes(x=x, y=upr), lty=2, color="black", data=ci) + 
    xlim(c(-2, 2)) + ylim(c(-2, 2)) + 
    xlab(NULL) + ylab(NULL) + 
    geom_text(aes(x=-1.9, y=1.9, 
             label="Continuity (points) + \nContinuity (line) +\nCommon Region \n(error bands)"), hjust=0, vjust=1, size=6) +
    theme_minimal()  + 
    theme(axis.text=element_blank(), axis.title=element_blank(),
          text=element_blank(), title=element_blank(),
          panel.border = element_rect(fill=NA, color="black"),
          panel.background = element_rect(fill = "grey90", colour = NA),
          plot.background = element_rect(fill = "transparent", colour = NA),
          plot.margin=unit(c(0,0,0,0), "cm"))
  
end.rcode-->
        </td>
      </tr>
    </table>
  </section>
  
  <section>
    <h2> Cluster Target Identification </h2>
<!--begin.rcode cluster-target, echo=F, include=T, fig.width=6, fig.height=3, out.width='70%', out.height='auto'
group.model <- glmer(cluster.correct~ plottype + (1|individualID) + (1|dataset), 
                     data = modeldata, 
                     family = binomial(link="logit"), 
                     control=glmerControl(optimizer="bobyqa"))
group.fixef <- data.frame(summary(group.model)$coefficients, confint(group.model, method="Wald"))
names(group.fixef) <- c("Estimate", "StdError", "Z", "p value", "LB", "UB")
group.fixef$OR <- exp(group.fixef[,1])
group.fixef$label <- gsub("(Intercept)", "", gsub("plottype", "", rownames(group.fixef)), fixed=T)

type_compare <- glht(group.model, mcp(plottype="Tukey"))
group.fixef$letters <- cld(type_compare)$mcletters$Letters

group.fixef2 <- group.fixef[2:10,]
group.fixef2 <- group.fixef2[order(group.fixef2$OR, decreasing = T),]
group.fixef2$label <- 
  group.fixef2$label %>% 
  str_replace("color", "Color + ") %>% 
  str_replace("[sS]hape", "Shape + ") %>%
  str_replace("[tT]rend", "Trend + ") %>%
  str_replace("Ellipse", "Ellipse + ") %>%
  str_replace("Error", "Error + ") %>%
  str_replace("( \\+ )$", "")
group.fixef2$label <- factor(group.fixef2$label, levels=group.fixef2$label[order(group.fixef2$OR, decreasing = T)], ordered=T)
group.fixef2$LB <- exp(group.fixef2$LB)
group.fixef2$UB <- exp(group.fixef2$UB)

qplot(data=group.fixef2, x=label, y=OR, ymin=LB, ymax=UB, geom="pointrange") + 
  geom_text(aes(x=label, y=0.3, label=letters)) + 
  coord_flip() + 
  scale_y_continuous("Odds + 95% Wald Interval", breaks=c(.5, .75, 1, 1.25)) + 
  xlab("") + 
  geom_hline(yintercept=1, colour="gray70") +
  ggtitle("Odds of Selecting Cluster Target Plot") + 
  theme_bw()
end.rcode-->
  <p> Trend + Error aesthetics decrease the odds of selecting the cluster target <br> Ellipses also <i>decrease</i> the odds of selecting the cluster target. </p>
  </section>
  
  <section>
    <h2> Gestalt Heuristics and Aesthetics </h2>
    <h3 class="nopadding"> Cluster Target Plots </h3>
    <table class="nopadding noborder nowidth">
      <tr>
        <td style="vertical-align:middle;text-align:center;" rowspan=2>
<!--begin.rcode gestaltplots4, dev.args = list(bg = 'transparent'), class="fragment", fragIndex=2, echo=F, fig.width=4, fig.height=4, out.width='275px', out.height='275px', fig.show='hold'

  set.seed(50980)
  data <- mixture.sim(lambda=1, K=3, N=45, sd.trend=.25, sd.cluster=.20)
  qplot(data=data, x=x, y=y, geom="point", size=I(3), shape=I(1)) + 
    xlim(c(-2, 2)) + ylim(c(-2, 2)) + 
    xlab(NULL) + ylab(NULL) + 
    geom_text(aes(x=-1.9, y=1.9, 
             label="Proximity"), hjust=0, vjust=1, size=6) +
    theme_minimal()  + 
    theme(axis.text=element_blank(), axis.title=element_blank(),
          text=element_blank(), title=element_blank(),
          panel.border = element_rect(fill=NA, color="black"),
          panel.background = element_rect(fill = "grey90", colour = NA),
          plot.background = element_rect(fill = "transparent", colour = NA),
          plot.margin=unit(c(0,0,0,0), "cm"))
  
end.rcode-->
        </td>
        <td style="vertical-align:middle;text-align:center;">
<!--begin.rcode gestaltplots5, dev.args = list(bg = 'transparent'), class="fragment", fragIndex=3, echo=F, include=T, fig.width=4, fig.height=4, out.width='275px', out.height='275px', fig.show='hold'
  set.seed(50980)
  data <- mixture.sim(lambda=1, K=3, N=45, sd.trend=.25, sd.cluster=.20)
  qplot(data=data, x=x, y=y, geom="point", size=I(3), shape=factor(group)) + 
    scale_shape_manual(guide="none", values=shape3pal) + 
    xlim(c(-2, 2)) + ylim(c(-2, 2)) + 
    xlab(NULL) + ylab(NULL) + 
    geom_text(aes(x=-1.9, y=1.9, label="Proximity (points) + \nSimilarity (shape)"), hjust=0, vjust=1, size=6) +
    theme_minimal()  + 
    theme(axis.text=element_blank(), axis.title=element_blank(),
          text=element_blank(), title=element_blank(),
          panel.border = element_rect(fill=NA, color="black"),
          panel.background = element_rect(fill = "grey90", colour = NA),
          plot.background = element_rect(fill = "transparent", colour = NA),
          plot.margin=unit(c(0,0,0,0), "cm"))
end.rcode-->
        </td>
        <td style="vertical-align:middle;text-align:center;">
<!--begin.rcode gestaltplots6, dev.args = list(bg = 'transparent'), class="fragment", fragIndex=4, echo=F, include=T, fig.width=4, fig.height=4, out.width='275px', out.height='275px'

  set.seed(50980)
  data <- mixture.sim(lambda=1, K=3, N=45, sd.trend=.25, sd.cluster=.20)
  qplot(data=data, x=x, y=y, geom="point", size=I(3), shape=factor(group), color=factor(group)) +
    scale_color_manual(guide="none", values=color3pal) +
    scale_shape_manual(guide="none", values=shape3pal) + 
    xlim(c(-2, 2)) + ylim(c(-2, 2)) + 
    xlab(NULL) + ylab(NULL) + 
    geom_text(aes(x=-1.9, y=1.9, label="Proximity (points) + \nSimilarity (shape) + \nSimilarity (color)"), hjust=0, vjust=1, size=6) +
    theme_minimal()  + 
    theme(axis.text=element_blank(), axis.title=element_blank(),
          text=element_blank(), title=element_blank(),
          panel.border = element_rect(fill=NA, color="black"),
          panel.background = element_rect(fill = "grey90", colour = NA),
          plot.background = element_rect(fill = "transparent", colour = NA),
          plot.margin=unit(c(0,0,0,0), "cm"))
end.rcode-->
        </td>
        <td style="vertical-align:middle;text-align:center;" rowspan=2>
<!--begin.rcode gestaltplots7, dev.args = list(bg = 'transparent'), class="fragment", fragIndex=5, echo=F, include=T, fig.width=4, fig.height=4, out.width='275px', out.height='275px', fig.show='hold'

  set.seed(50980)
  data <- mixture.sim(lambda=1, K=3, N=45, sd.trend=.25, sd.cluster=.20)
  qplot(data=data, x=x, y=y, geom="point", size=I(3), shape=factor(group), color=factor(group)) +
    stat_ellipse(geom="polygon", level=.9, aes(colour=factor(group)), alpha=0.2, fill=NA) + 
    scale_color_manual(guide="none", values=color3pal) +
    scale_shape_manual(guide="none", values=shape3pal) + 
    xlim(c(-2, 2)) + ylim(c(-2, 2)) + 
    xlab(NULL) + ylab(NULL) + 
    geom_text(aes(x=-1.9, y=1.9, label="Proximity (points) + \nSimilarity (shape) + \nSimilarity (color) + \nCommon Region (ellipse)"), hjust=0, vjust=1, size=6) +
    theme_minimal()  + 
    theme(axis.text=element_blank(), axis.title=element_blank(),
          text=element_blank(), title=element_blank(),
          panel.border = element_rect(fill=NA, color="black"),
          panel.background = element_rect(fill = "grey90", colour = NA),
          plot.background = element_rect(fill = "transparent", colour = NA),
          plot.margin=unit(c(0,0,0,0), "cm"))
end.rcode-->
        </td>
      </tr>
      <tr>
        <td style="vertical-align:middle;text-align:center;">
<!--begin.rcode gestaltplots5-1, dev.args = list(bg = 'transparent'), class="fragment", fragIndex=3, echo=F, include=T, fig.width=4, fig.height=4, out.width='275px', out.height='275px', fig.show='hold'

  set.seed(50980)
  data <- mixture.sim(lambda=1, K=3, N=45, sd.trend=.25, sd.cluster=.20)
  qplot(data=data, x=x, y=y, geom="point", size=I(3), color=factor(group), shape=I(1)) + 
    scale_color_manual(guide="none", values=color3pal) + 
    xlim(c(-2, 2)) + ylim(c(-2, 2)) + 
    xlab(NULL) + ylab(NULL) + 
    geom_text(aes(x=-1.9, y=1.9, label="Proximity (points) + \nSimilarity (color)"), hjust=0, vjust=1, size=6) +
    theme_minimal()  + 
    theme(axis.text=element_blank(), axis.title=element_blank(),
          text=element_blank(), title=element_blank(),
          panel.border = element_rect(fill=NA, color="black"),
          panel.background = element_rect(fill = "grey90", colour = NA),
          plot.background = element_rect(fill = "transparent", colour = NA),
          plot.margin=unit(c(0,0,0,0), "cm"))
  
end.rcode-->
        </td>
        <td style="vertical-align:middle;text-align:center;">
<!--begin.rcode gestaltplots6-1, dev.args = list(bg = 'transparent'), class="fragment", fragIndex=4, echo=F, include=T, fig.width=4, fig.height=4, out.width='275px', out.height='275px'

  set.seed(50980)
  data <- mixture.sim(lambda=1, K=3, N=45, sd.trend=.25, sd.cluster=.20)
  qplot(data=data, x=x, y=y, geom="point", size=I(3), color=factor(group), shape=I(1)) + 
    stat_ellipse(geom="polygon", level=.9, aes(colour=factor(group)), alpha=0.2, fill=NA) + 
    scale_color_manual(guide="none", values=color3pal) + 
    xlim(c(-2, 2)) + ylim(c(-2, 2)) + 
    xlab(NULL) + ylab(NULL) + 
    geom_text(aes(x=-1.9, y=1.9, label="Proximity (points) + \nSimilarity (color) + \nCommon Region (ellipse)"), hjust=0, vjust=1, size=6) +
    theme_minimal()  + 
    theme(axis.text=element_blank(), axis.title=element_blank(),
          text=element_blank(), title=element_blank(),
          panel.border = element_rect(fill=NA, color="black"),
          panel.background = element_rect(fill = "grey90", colour = NA),
          plot.background = element_rect(fill = "transparent", colour = NA),
          plot.margin=unit(c(0,0,0,0), "cm"))
  
end.rcode-->
        </td>
      </tr>
    </table>
  </section>
  
  <section>
    <h2> Cluster Target Identification </h2>
    <img src="image/lineup-ellipse-issue.png", width='50%', height='auto'/>
  </section>
  
  <section>
    <h2> Cluster vs. Trend </h2>
<!--begin.rcode cluster-vs-line, echo=F, include=T, fig.width=7, fig.height=4, out.width='70%', out.height='auto'
designs <- ddply(modeldata, .(dataset, plottype), summarise, evals=length(data_name), group=sum(cluster.correct), line=sum(trend.correct))
designs$perc <- with(designs, group/(group+line))
#qplot(plottype, perc, data=designs, geom="boxplot")
gvl.model <- glmer(cbind(group, line)~plottype+(1|dataset), data=designs, family=binomial())
gvl.fixef <- data.frame(confint(gvl.model, method="Wald"))
names(gvl.fixef) <- c("LB", "UB")
gvl.fixef$OR <- fixef(gvl.model)

suppressMessages(require(multcomp))
type_compare <- glht(gvl.model, mcp(plottype="Tukey"))
gvl.fixef$letters <- cld(type_compare)$mcletters$Letters

gvl.fixef$label <- gsub("plottype", "", names(fixef(gvl.model)))
gvl.fixef$label <- gvl.fixef$label %>% 
  str_replace("color", "Color + ") %>% 
  str_replace("[sS]hape", "Shape + ") %>%
  str_replace("[tT]rend", "Trend + ") %>%
  str_replace("Ellipse", "Ellipse + ") %>%
  str_replace("Error", "Error + ") %>%
  str_replace("( \\+ )$", "") %>% 
  reorder(gvl.fixef$OR)

ggplot(data=gvl.fixef[-1,]) + 
  geom_pointrange(aes(x=label, y=exp(OR), ymin=exp(LB), ymax=exp(UB))) + 
  coord_flip() + 
  theme_bw() + 
  geom_hline(yintercept=1, colour="gray70") + 
  ggtitle("Odds of Selecting Group vs Line Target \n (given one target was identified)") + 
  ylab("Odds (Group vs Line) and 95% Wald Intervals") + 
  xlab("Plot Type") + 
  geom_text(aes(y=0.4, x=label, label=letters))
end.rcode-->
  </section>
  
  <section>
    <h2> Response Time </h2>
    <br></br>
    $$
    \begin{align}
    \log(\text{Trial Time}) &\sim& \textbf{X}\beta + \textbf{J}\gamma + \textbf{K}\eta + \epsilon\\
    \text{where} \beta_i & \text{describe outcome and aesthetic combinations, plus an initial trial effect}\\
    \hphantom{where } \gamma_j & \overset{iid}{\sim} N\left(0, \sigma^2_{\text{dataset}}\right)\\
    \hphantom{where } \eta_k & \overset{iid}{\sim} N\left(0, \sigma^2_{\text{participant}}\right)\\
    \text{and } \epsilon_{ijk} & \overset{iid}{\sim}  N\left(0, \sigma^2_e\right)
    \end{align}
    $$
  </section>
    
  <section>
    <h2> Gestalt Heuristics and Aesthetics </h2>
    <h3> Mixed Signals </h3>
    <div align="center">
    <table class="nopadding noborder nowidth">
      <tr>
        <td style="vertical-align:middle;text-align:center;">
<!--begin.rcode gestaltplots8, dev.args = list(bg = 'transparent'), class="fragment", fragIndex=2, echo=F, fig.width=4, fig.height=4, out.width='275px', out.height='275px'

  set.seed(50980)
  data <- mixture.sim(lambda=0, K=3, N=45, sd.trend=.25, sd.cluster=.20)
  model <- lm(y~x, data=data)
  range <- diff(range(data$x))
  newdata <- data.frame(x=seq(min(data$x)-.1*range, max(data$x)+.1*range, length.out=400))
  ci <- data.frame(.sample=1, x=newdata$x, 
                   predict.lm(model, newdata=newdata, interval="prediction", level=0.9))
  qplot(data=data, x=x, y=y, geom="point", size=I(3), shape=I(1), color=factor(group)) + 
    geom_line(aes(x=x, y=fit), color="black", data=ci) + 
    scale_color_manual(guide="none", values=color3pal) + 
    xlim(c(-2.4, 2.4)) + ylim(c(-2.4, 2.4)) + 
    xlab(NULL) + ylab(NULL) + 
    geom_text(aes(x=-2.3, y=2.3, label="Continuity (points) + \nContinuity (line)"), hjust=0, vjust=1, size=6) +
    geom_text(aes(x=2.3, y=-2.3, label="Similarity (color)"), hjust=1, vjust=0, size=6) +
    theme_minimal()  + 
    theme(axis.text=element_blank(), axis.title=element_blank(),
          text=element_blank(), title=element_blank(),
          panel.border = element_rect(fill=NA, color="black"),
          panel.background = element_rect(fill = "grey90", colour = NA),
          plot.background = element_rect(fill = "transparent", colour = NA),
          plot.margin=unit(c(0,0,0,0), "cm"))
  
end.rcode-->
        </td>
        <td style="vertical-align:middle;text-align:center;">
<!--begin.rcode gestaltplots9, dev.args = list(bg = 'transparent'), class="fragment", fragIndex=3, echo=F, fig.width=4, fig.height=4, out.width='275px', out.height='275px'

  set.seed(50980)
  data <- mixture.sim(lambda=.5, K=3, N=45, sd.trend=.25, sd.cluster=.20)
  model <- lm(y~x, data=data)
  range <- diff(range(data$x))
  newdata <- data.frame(x=seq(min(data$x)-.1*range, max(data$x)+.1*range, length.out=400))
  ci <- data.frame(.sample=1, x=newdata$x, 
                   predict.lm(model, newdata=newdata, interval="prediction", level=0.9))
  qplot(data=data, x=x, y=y, geom="point", size=I(3), shape=I(1), color=factor(group)) + 
    geom_line(aes(x=x, y=fit), color="black", data=ci) + 
    scale_color_manual(guide="none", values=color3pal) + 
    xlim(c(-2.4, 2.4)) + ylim(c(-2.4, 2.4)) + 
    xlab(NULL) + ylab(NULL) + 
    geom_text(aes(x=-2.3, y=2.3, label="Continuity (line)"), hjust=0, vjust=1, size=6) +
    geom_text(aes(x=2.3, y=-2.3, label="Similarity (color)"), hjust=1, vjust=0, size=6) +
    theme_minimal()  + 
    theme(axis.text=element_blank(), axis.title=element_blank(),
          text=element_blank(), title=element_blank(),
          panel.border = element_rect(fill=NA, color="black"),
          panel.background = element_rect(fill = "grey90", colour = NA),
          plot.background = element_rect(fill = "transparent", colour = NA),
          plot.margin=unit(c(0,0,0,0), "cm"))
  
end.rcode-->
        </td>
        <td style="vertical-align:middle;text-align:center;">
<!--begin.rcode gestaltplots10, dev.args = list(bg = 'transparent'), class="fragment", fragIndex=4, echo=F, fig.width=4, fig.height=4, out.width='275px', out.height='275px'

  set.seed(50980)
  data <- mixture.sim(lambda=1, K=3, N=45, sd.trend=.25, sd.cluster=.20)
  model <- lm(y~x, data=data)
  range <- diff(range(data$x))
  newdata <- data.frame(x=seq(min(data$x)-.1*range, max(data$x)+.1*range, length.out=400))
  ci <- data.frame(.sample=1, x=newdata$x, 
                   predict.lm(model, newdata=newdata, interval="prediction", level=0.9))
  qplot(data=data, x=x, y=y, geom="point", size=I(3), shape=I(1), color=factor(group)) + 
    geom_line(aes(x=x, y=fit), color="black", data=ci) + 
    scale_color_manual(guide="none", values=color3pal) + 
    xlim(c(-2.4, 2.4)) + ylim(c(-2.4, 2.4)) + 
    xlab(NULL) + ylab(NULL) + 
    geom_text(aes(x=-2.3, y=2.3, label="Continuity (line)"), hjust=0, vjust=1, size=6) +
    geom_text(aes(x=2.3, y=-2.3, label="Proximity (points)\n + Similarity (color)"), hjust=1, vjust=0, size=6) +
    theme_minimal()  + 
    theme(axis.text=element_blank(), axis.title=element_blank(),
          text=element_blank(), title=element_blank(),
          panel.border = element_rect(fill=NA, color="black"),
          panel.background = element_rect(fill = "grey90", colour = NA),
          plot.background = element_rect(fill = "transparent", colour = NA),
          plot.margin=unit(c(0,0,0,0), "cm"))
  
end.rcode-->
        </td>
      </tr>
      <tr>
        <td style="vertical-align:middle;text-align:center;">
<!--begin.rcode gestaltplots11, dev.args = list(bg = 'transparent'), class="fragment", fragIndex=2, echo=F, include=T, fig.width=4, fig.height=4, out.width='275px', out.height='275px'

  set.seed(50980)
  data <- mixture.sim(lambda=0, K=3, N=45, sd.trend=.25, sd.cluster=.20)
  model <- lm(y~x, data=data)
  range <- diff(range(data$x))
  newdata <- data.frame(x=seq(min(data$x)-.1*range, max(data$x)+.1*range, length.out=400))
  ci <- data.frame(.sample=1, x=newdata$x, 
                   predict.lm(model, newdata=newdata, interval="prediction", level=0.9))
  qplot(data=data, x=x, y=y, geom="point", size=I(3), shape=I(1), color=factor(group)) + 
    geom_line(aes(x=x, y=fit), color="black", data=ci) + 
    stat_ellipse(geom="polygon", level=.9, aes(colour=factor(group)), alpha=0.2, fill=NA) + 
    geom_line(aes(x=x, y=lwr), lty=2, color="black", data=ci) + 
    geom_line(aes(x=x, y=upr), lty=2, color="black", data=ci) + 
    scale_color_manual(guide="none", values=color3pal) + 
    xlim(c(-2.4, 2.4)) + ylim(c(-2.4, 2.4)) + 
    xlab(NULL) + ylab(NULL) + 
    geom_text(aes(x=-2.3, y=2.3, label="Continuity (points) + \nContinuity (line) + \nCommon Region\n(error bands)"), hjust=0, vjust=1, size=6) + 
    geom_text(aes(x=2.3, y=-2.3, label="Similarity (color)\n + Common Region (ellipse)"), hjust=1, vjust=0, size=6) +
    theme_minimal()  + 
    theme(axis.text=element_blank(), axis.title=element_blank(),
          text=element_blank(), title=element_blank(),
          panel.border = element_rect(fill=NA, color="black"),
          panel.background = element_rect(fill = "grey90", colour = NA),
          plot.background = element_rect(fill = "transparent", colour = NA),
          plot.margin=unit(c(0,0,0,0), "cm"))
  
end.rcode-->
        </td>
        <td style="vertical-align:middle;text-align:center;">
<!--begin.rcode gestaltplots12, dev.args = list(bg = 'transparent'), class="fragment", fragIndex=3, echo=F, include=T, fig.width=4, fig.height=4, out.width='275px', out.height='275px'

  set.seed(50980)
  data <- mixture.sim(lambda=.5, K=3, N=45, sd.trend=.25, sd.cluster=.20)
  model <- lm(y~x, data=data)
  range <- diff(range(data$x))
  newdata <- data.frame(x=seq(min(data$x)-.1*range, max(data$x)+.1*range, length.out=400))
  ci <- data.frame(.sample=1, x=newdata$x, 
                   predict.lm(model, newdata=newdata, interval="prediction", level=0.9))
  qplot(data=data, x=x, y=y, geom="point", size=I(3), shape=I(1), color=factor(group)) + 
    geom_line(aes(x=x, y=fit), color="black", data=ci) + 
    stat_ellipse(geom="polygon", level=.9, aes(colour=factor(group)), alpha=0.2, fill=NA) + 
    geom_line(aes(x=x, y=lwr), lty=2, color="black", data=ci) + 
    geom_line(aes(x=x, y=upr), lty=2, color="black", data=ci) + 
    scale_color_manual(guide="none", values=color3pal) + 
    xlim(c(-2.4, 2.4)) + ylim(c(-2.4, 2.4)) + 
    xlab(NULL) + ylab(NULL) + 
    geom_text(aes(x=-2.3, y=2.3, label="Continuity (line) + \nCommon Region\n(error bands)"), hjust=0, vjust=1, size=6) + 
    geom_text(aes(x=2.3, y=-2.3, label="Similarity (color)\n + Common Region (ellipse)"), hjust=1, vjust=0, size=6) +
    theme_minimal()  + 
    theme(axis.text=element_blank(), axis.title=element_blank(),
          text=element_blank(), title=element_blank(),
          panel.border = element_rect(fill=NA, color="black"),
          panel.background = element_rect(fill = "grey90", colour = NA),
          plot.background = element_rect(fill = "transparent", colour = NA),
          plot.margin=unit(c(0,0,0,0), "cm"))
  
end.rcode-->
        </td>
        <td style="vertical-align:middle;text-align:center;">
<!--begin.rcode gestaltplots13, dev.args = list(bg = 'transparent'), class="fragment", fragIndex=4, echo=F, include=T, fig.width=4, fig.height=4, out.width='275px', out.height='275px'

  set.seed(50980)
  data <- mixture.sim(lambda=1, K=3, N=45, sd.trend=.25, sd.cluster=.20)
  model <- lm(y~x, data=data)
  range <- diff(range(data$x))
  newdata <- data.frame(x=seq(min(data$x)-.1*range, max(data$x)+.1*range, length.out=400))
  ci <- data.frame(.sample=1, x=newdata$x, 
                   predict.lm(model, newdata=newdata, interval="prediction", level=0.9))
  qplot(data=data, x=x, y=y, geom="point", size=I(3), shape=I(1), color=factor(group)) + 
    geom_line(aes(x=x, y=fit), color="black", data=ci) + 
    stat_ellipse(geom="polygon", level=.9, aes(colour=factor(group)), alpha=0.2, fill=NA) + 
    geom_line(aes(x=x, y=lwr), lty=2, color="black", data=ci) + 
    geom_line(aes(x=x, y=upr), lty=2, color="black", data=ci) + 
    scale_color_manual(guide="none", values=color3pal) + 
    xlim(c(-2.4, 2.4)) + ylim(c(-2.4, 2.4)) + 
    xlab(NULL) + ylab(NULL) + 
    geom_text(aes(x=-2.3, y=2.3, label="Continuity (line) + \nCommon Region\n(error bands)"), hjust=0, vjust=1, size=6) + 
    geom_text(aes(x=2.3, y=-2.3, label="Proximity (points)\n + Similarity (color)\n + Common Region (ellipse)"), hjust=1, vjust=0, size=6) +
    theme_minimal()  + 
    theme(axis.text=element_blank(), axis.title=element_blank(),
          text=element_blank(), title=element_blank(),
          panel.border = element_rect(fill=NA, color="black"),
          panel.background = element_rect(fill = "grey90", colour = NA),
          plot.background = element_rect(fill = "transparent", colour = NA),
          plot.margin=unit(c(0,0,0,0), "cm"))
  
end.rcode-->
        </td>
      </tr>
    </table>
    </div>
  </section>
  
  <section>
    <h2> Response Time </h2>
<!--begin.rcode response-time-aes, echo=F, include=T, fig.width=9, fig.height=4, out.width='90%', out.height='auto'
library(lubridate)

# modeldata$time_taken <- as.numeric(ymd_hms(modeldata$end_time) - ymd_hms(modeldata$start_time))
time.model <- lmer(log(as.numeric(trial.time))~ simpleoutcome:plottype + first.trial  + (1|individualID) + (1|dataset), data=modeldata)

coefs <- data.frame(exp(confint(time.model, method="Wald")))[-c(1:2),]
names(coefs) <- c("low", "high")
coefs$estimate <- exp(fixef(time.model)[-c(1:2)])
coefs$name <- names(fixef(time.model))[-c(1:2)]
ll <- ldply(strsplit(coefs$name, split=":"), function(x) x)
coefs$outcome <- gsub("simpleoutcome", "", ll$V1)
coefs$plottype <- gsub("plottype", "", ll$V2)
coefs$simple <- coefs$outcome %in% c("both") - coefs$outcome%in%c("neither")
coefs$simple <- factor(coefs$simple)
levels(coefs$simple) <- c("Neither", "Cluster, Trend", "Both")
coefs$outcome <- factor(coefs$outcome, levels=c("neither", "cluster", "trend", "both"))

coefs$plottype <- coefs$plottype %>% 
  str_replace("color", "Color + ") %>% 
  str_replace("[sS]hape", "Shape + ") %>%
  str_replace("[tT]rend", "Trend + ") %>%
  str_replace("Ellipse", "Ellipse + ") %>%
  str_replace("Error", "Error + ") %>%
  str_replace("plain", "Plain") %>%
  str_replace("( \\+ )$", "")
coefs$plottype <- factor(coefs$plottype)

coefs <- ddply(coefs, .(plottype), transform, avg.est=mean(estimate))
coefs$plottype <- with(coefs, reorder(plottype, avg.est))

coefs$outcome <- factor(coefs$outcome, levels=c("neither", "trend", "cluster", "both"), labels=c("Neither", "Trend", "Cluster", "Both"))
coefs$out.factor <- factor(str_replace(as.character(coefs$outcome), "Trend|Cluster", "Single"), levels=c("Neither", "Single", "Both"), labels=c("Neither Target", "Single Target", "Both Targets"))
coefs$pos <- as.numeric(factor(coefs$plottype)) + as.numeric(coefs$out.factor=="Single Target")*(as.numeric(coefs$outcome)-2.5)*1/3

qplot(x=estimate, y=pos, data=coefs, colour=outcome, shape=outcome, size=I(3)) + theme_bw() + 
  scale_colour_brewer("Target Identified", palette="Set1") +
  scale_shape_manual("Target Identified", values=c(4, 1, 2, 8)) +
  geom_segment(aes(x=low, xend=high, y=pos, yend=pos),guide="none") + 
  scale_y_continuous(breaks=1:10, labels=levels(coefs$plottype)) + 
  xlab("Additional time to evaluate plot (in seconds) given outcome") + ylab("") + 
  theme(legend.position="bottom") + 
  ggtitle("Evaluation Time by Aesthetics and Outcome") + 
  facet_grid(.~out.factor, scales="free_x")
end.rcode-->
  </section>
  
  <section>
    <h2> Response Time </h2>
    <br></br>
    $$
    \begin{align}
    \log(\text{Trial Time}) \sim& \textbf{X}\beta + \textbf{J}\eta + \epsilon\\
    \text{where } \beta_i & \text{ describe outcome and model parameter interactions, }\\
    &\text{ plus initial trial and aesthetic effects}\\
    \hphantom{where } \eta_j & \overset{iid}{\sim} N\left(0, \sigma^2_{\text{participant}}\right)\\
    \text{and } \epsilon_{ij} & \overset{iid}{\sim}  N\left(0, \sigma^2_e\right)
    \end{align}
    $$
  </section>

  <section>
    <h2> Response Time </h2>
<!--begin.rcode response-time-parms, echo=F, include=T, fig.width=9, fig.height=8, out.width='50%', out.height='auto', warning=FALSE, message=FALSE
time.model2 <- lmer(log(as.numeric(trial.time))~ first.trial + plottype + simpleoutcome:trend.diff:cluster.diff:k  + (1|individualID) , data=modeldata)

coefs <- data.frame(exp(confint(time.model2, method="Wald")))[-(1:11),]
names(coefs) <- c("low", "high")
coefs$estimate <- exp(fixef(time.model2)[-(1:11)])
coefs$name <- names(fixef(time.model2))[-(1:11)]
ll <- ldply(strsplit(coefs$name, split=":"), function(x) x)
coefs$outcome <- gsub("simpleoutcome", "", ll$V1)
coefs$trend.diff <- gsub("trend\\.diff", "", ll$V2)
coefs$trend.diff <- factor(coefs$trend.diff, levels=c("easy", "medium", "hard"), labels=paste0("Trend:", c("Easy", "Medium", "Hard")))
coefs$cluster.diff <- gsub("cluster\\.diff", "", ll$V3)
coefs$cluster.diff <- factor(coefs$cluster.diff, levels=c("easy", "medium", "hard"), labels=paste0("Cluster:", c("Easy", "Medium", "Hard")))
coefs$k <- gsub("k", "", ll$V4)
coefs$simple <- coefs$outcome %in% c("both") - coefs$outcome%in%c("neither")
coefs$simple <- factor(coefs$simple)
levels(coefs$simple) <- c("Neither", "Cluster, Trend", "Both")

coefs$outcome <- factor(coefs$outcome, levels=c("neither", "cluster", "trend", "both"), labels=c("Neither Identified", "Cluster Identified", "Trend Identified", "Both Identified"))
coefs$pos <- as.numeric(factor(coefs$k)) + (as.numeric(factor(coefs$trend.diff))-2)/4

qplot(estimate, pos, data=subset(coefs, outcome!="Both Identified"), colour=trend.diff, size=I(4), shape=trend.diff) + theme_bw() + 
  scale_colour_manual("Trend", values=c("#7bccc4", "#2b8cbe", "#084081")) +
  scale_shape_discrete("Trend") + 
  geom_segment(aes(x=low, xend=high, y=pos, yend=pos)) + 
  facet_grid(cluster.diff~outcome) + 
  scale_y_continuous(breaks=1:2, labels=unique(coefs$k), limits=c(0.5,2.5)) + 
  xlab("Additional time to evaluate each plot type (in seconds) given outcome") + ylab("K") + 
  ggtitle("Evaluation Time by Model Parameters and Outcome")
end.rcode-->
  </section>
  
  <section>
    <h2> Participant Reasoning </h2>
      <h3> Plain Plots </h3>
<!--begin.rcode wordles-plain, echo=F, include=T, fig.width=4, fig.height=4, out.width='350px', out.height='350px'
lexicaldata <- modeldata
lexicaldata$choice_reason <- tolower(lexicaldata$choice_reason)
lexicaldata$choice_reason <- gsub("^_", "", lexicaldata$choice_reason)

words <- lexicaldata %>% group_by(plottype, simpleoutcome) %>% 
  summarize(list = paste(choice_reason, collapse=" ")) %>% filter(simpleoutcome != "both", plottype %in% c("plain", "color", "trend", "colorEllipse"))

library(wordcloud)
library(tm)
for (i in 1:3) {
words.corpus <- Corpus(DataframeSource(data.frame(words$list[i])))
words.corpus <- tm_map(words.corpus, removePunctuation)

tdm <- TermDocumentMatrix(words.corpus)
m <- as.matrix(tdm)
v <- sort(rowSums(m),decreasing=TRUE)
d <- data.frame(word = names(v),freq=v)
pal <- brewer.pal(9, "BuGn")
pal <- pal[-(1:2)]
# png(sprintf("wordcloud/wordcloud-%s-%s.png",words$plottype[i], words$simpleoutcome[i]), width=960,height=600)
wordcloud(d$word,d$freq, scale=c(8,.3),min.freq=2,max.words=100, random.order=T, rot.per=.15, colors="black", vfont=c("sans serif","plain"))
# dev.off()
}
end.rcode-->
    <div align="center">
    <table class="noborder nowidth nopadding">
      <tr>
        <td width='350px' style="text-align:center;"> Neither Target </td><td width='350px' style="text-align:center;"> Cluster Target </td> <td width='350px' style="text-align:center;"> Trend Target </td>
      </tr>
    </table>
    </div>
  </section>
  <section>
    <h2> Participant Reasoning </h2>
      <h3> Trend Line Plots </h3>
<!--begin.rcode wordles-line, dependson='wordles', echo=F, include=T, fig.width=4, fig.height=4, out.width='350px', out.height='350px'
for (i in 4:6) {
words.corpus <- Corpus(DataframeSource(data.frame(words$list[i])))
words.corpus <- tm_map(words.corpus, removePunctuation)

tdm <- TermDocumentMatrix(words.corpus)
m <- as.matrix(tdm)
v <- sort(rowSums(m),decreasing=TRUE)
d <- data.frame(word = names(v),freq=v)
pal <- brewer.pal(9, "BuGn")
pal <- pal[-(1:2)]
# png(sprintf("wordcloud/wordcloud-%s-%s.png",words$plottype[i], words$simpleoutcome[i]), width=960,height=600)
wordcloud(d$word,d$freq, scale=c(8,.3),min.freq=2,max.words=100, random.order=T, rot.per=.15, colors="black", vfont=c("sans serif","plain"))
# dev.off()
}
end.rcode-->
    <div align="center">
    <table class="noborder nowidth nopadding">
      <tr>
        <td width='350px' style="text-align:center;"> Neither Target </td><td width='350px' style="text-align:center;"> Cluster Target </td> <td width='350px' style="text-align:center;"> Trend Target </td>
      </tr>
    </table>
    </div>
  </section>
  <section>
    <h2> Participant Reasoning </h2>
      <h3> Color Plots </h3>
<!--begin.rcode wordles-color, dependson='wordles', echo=F, include=T, fig.width=4, fig.height=4, out.width='350px', out.height='350px'
for (i in 7:9) {
words.corpus <- Corpus(DataframeSource(data.frame(words$list[i])))
words.corpus <- tm_map(words.corpus, removePunctuation)

tdm <- TermDocumentMatrix(words.corpus)
m <- as.matrix(tdm)
v <- sort(rowSums(m),decreasing=TRUE)
d <- data.frame(word = names(v),freq=v)
pal <- brewer.pal(9, "BuGn")
pal <- pal[-(1:2)]
# png(sprintf("wordcloud/wordcloud-%s-%s.png",words$plottype[i], words$simpleoutcome[i]), width=960,height=600)
wordcloud(d$word,d$freq, scale=c(8,.3),min.freq=2,max.words=100, random.order=T, rot.per=.15, colors="black", vfont=c("sans serif","plain"))
# dev.off()
}
end.rcode-->
    <div align="center">
    <table class="noborder nowidth nopadding">
      <tr>
        <td width='350px' style="text-align:center;"> Neither Target </td><td width='350px' style="text-align:center;"> Cluster Target </td> <td width='350px' style="text-align:center;"> Trend Target </td>
      </tr>
    </table>
    </div>
  </section>
  <section>
    <h2> Participant Reasoning </h2>
      <h3> Color + Ellipse Plots </h3>
<!--begin.rcode wordles-colorEllipse, dependson='wordles', echo=F, include=T, fig.width=4, fig.height=4, out.width='350px', out.height='350px'
for (i in 10:12) {
words.corpus <- Corpus(DataframeSource(data.frame(words$list[i])))
words.corpus <- tm_map(words.corpus, removePunctuation)

tdm <- TermDocumentMatrix(words.corpus)
m <- as.matrix(tdm)
v <- sort(rowSums(m),decreasing=TRUE)
d <- data.frame(word = names(v),freq=v)
pal <- brewer.pal(9, "BuGn")
pal <- pal[-(1:2)]
# png(sprintf("wordcloud/wordcloud-%s-%s.png",words$plottype[i], words$simpleoutcome[i]), width=960,height=600)
wordcloud(d$word,d$freq, scale=c(8,.3),min.freq=2,max.words=100, random.order=T, rot.per=.15, colors="black", vfont=c("sans serif","plain"))
# dev.off()
}
end.rcode-->
    <div align="center">
    <table class="noborder nowidth nopadding">
      <tr>
        <td width='350px' style="text-align:center;"> Neither Target </td><td width='350px' style="text-align:center;"> Cluster Target </td> <td width='350px' style="text-align:center;"> Trend Target </td>
      </tr>
    </table>
    </div>
  </section>
  
  <section>
    <h2> Sentiment Analysis </h2>
<!--begin.rcode lexical-analysis, echo=FALSE, fig.width=8, fig.height=3, out.width='70%', out.height='auto'
lexicaldata <- modeldata
lexicaldata$choice_reason <- tolower(lexicaldata$choice_reason)

get.reason <- function(x){
  negs <- "non|not|less|weak|least|no|lack|but|divergent"
  groups <- "group|cluster|spot|region|separat|clump|space|sets|gap|bunch|apart|connected|segregat|split|overlap|touch|area|tight|intersection|divided"
  linear <- "line|linear|correlation|trend|slant|angle|straight|slope"
  variability <- "outlier|spread|diffuse|random|scatter"
    reasons = data.frame(
      linear = str_detect(x, linear) & 
        !str_detect(x, negs) &
        !str_detect(x, groups),
      group = str_detect(x, groups) & 
        !str_detect(x, linear),
      nonlinear = str_detect(x, linear) & 
        str_detect(x, negs) & 
        !str_detect(x, groups),
      both = str_detect(x, groups) & 
        str_detect(x, linear) & 
        !str_detect(x, negs),
      outliers = str_detect(x, variability) & !str_detect(x, linear) & !str_detect(x, groups)
      )
    res <- rep("", length(x))
    res[rowSums(reasons)==0] <- "other"
    if(sum(rowSums(reasons)>1)>1){
      warning("Reasons are not mutually exclusive")
    }
    res[reasons$linear] <- "linear"
    res[reasons$nonlinear] <- "nonlinear"
    res[reasons$group] <- "group"
    res[reasons$both] <- "linear & group"
    res[reasons$outlier] <- "outlier"
    if(length(res)==1) return(unlist(res))
    return(res)
}

lexicaldata <- lexicaldata %>% 
  mutate(reason = get.reason(choice_reason))

lexicaldata$outcome <- factor(lexicaldata$outcome, levels=c("neither", "trend", "cluster", "both"), labels=c("Neither", "Trend", "Cluster", "Both"))
lexicaldata$reason <- lexicaldata$reason %>% str_replace("nonlinear", "other") %>% str_replace("outlier", "other") %>% factor( levels=c("linear", "nonlinear", "linear & group", "group", "outlier",  "other"), labels=c("Linear sentiment", "Non-linear sentiment", "Linear + Group sentiment", "Group sentiment", "Variability/Outlier sentiment", "Other"))

qplot(data=lexicaldata, x=outcome, fill=reason, geom="histogram", position="dodge") + facet_wrap(~reason, ncol=4) + 
  scale_fill_brewer(guide="none", palette="Set1") + 
  ylab("# Responses") + 
  xlab("Outcome") + 
  ggtitle("Sentiment Expressed in Participant Explanations, by Trial Outcome") + 
  theme_bw()

end.rcode-->
  </section>
</section>

<section>
  <section class='center'>
    <h2> Discussion </h2>
  </section>
  
  <section>
    <h2> Conclusions </h2>
    <ul>
      <li>

</div> <!-- slides -->
</div> <!-- reveal -->

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>
<script>
	// Full list of configuration options available at:
	// https://github.com/hakimel/reveal.js#configuration
	Reveal.initialize({
		controls: true,
		progress: true,
		history: true,
		center: false,
		slideNumber: true,
		width: 1200,
		height: 800,
		margin: 0.05,
		transition: 'fade', // none/fade/slide/convex/concave/zoom
		// Optional reveal.js plugins
		dependencies: [
			{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
			{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
			{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
			{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
			{ src: 'plugin/zoom-js/zoom.js', async: true },
			{ src: 'plugin/notes/notes.js', async: true },
			{ src: 'plugin/math/math.js', async: true }
		]
	});
</script>
</body>
</html>
